services:

  architect-solo-deepseek-ai-DeepSeek-R1-Distill-Qwen-32B:
    image: lmsysorg/sglang:v0.5.5.post3-rocm700-mi30x
    container_name: vylabs-builder-solo
    ipc: host
    network_mode: host
    privileged: true
    cap_add: [SYS_PTRACE]
    security_opt: [seccomp=unconfined]
    ulimits: &rocm_ulimits
      memlock: -1
      stack: 67108864
      nofile: { soft: 1048576, hard: 1048576 }
    devices: &rocm_devices
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    volumes: &rocm_volumes
      - /mnt/scratch/huggingface:/root/.cache/huggingface
    environment:
      - SGLANG_ALLOW_OVERWRITE_LONGER_CONTEXT_LEN=1
      - HSA_NO_SCRATCH_RECLAIM=1
      - HF_HOME=/root/.cache/huggingface
      - GLOO_SOCKET_IFNAME=eth0
      - NCCL_SOCKET_IFNAME=eth0
      - SGLANG_USE_AITER=1
      # [CRITICAL] Prevent Infinite Loop/Garbled Text at 262k
      - VLLM_USE_TRITON_FLASH_ATTN=0
    command: >
      python3 -m sglang.launch_server
      --model-path deepseek-ai/DeepSeek-R1-Distill-Qwen-32B
      --tp 1 --host 0.0.0.0 --port 30000
      --mem-fraction-static 0.90
      --kv-cache-dtype bfloat16
      --context-length 262144
      --trust-remote-code
      --attention-backend aiter
      --chunked-prefill-size 32768
      --tool-call-parser qwen3_coder

  architect-solo-deepseek-ai-DeepSeek-R1-Distill-Qwen-14B:
    image: lmsysorg/sglang:v0.5.5.post3-rocm700-mi30x
    container_name: vylabs-builder-solo
    ipc: host
    network_mode: host
    privileged: true
    cap_add: [SYS_PTRACE]
    security_opt: [seccomp=unconfined]
    ulimits: *rocm_ulimits
    devices: *rocm_devices
    volumes: *rocm_volumes
    environment:
      - SGLANG_ALLOW_OVERWRITE_LONGER_CONTEXT_LEN=1
      - HSA_NO_SCRATCH_RECLAIM=1
      - HF_HOME=/root/.cache/huggingface
      - GLOO_SOCKET_IFNAME=eth0
      - NCCL_SOCKET_IFNAME=eth0
      - SGLANG_USE_AITER=1
      # [CRITICAL] Prevent Infinite Loop/Garbled Text at 262k
      - VLLM_USE_TRITON_FLASH_ATTN=0
    command: >
      python3 -m sglang.launch_server
      --model-path deepseek-ai/DeepSeek-R1-Distill-Qwen-14B
      --tp 1 --host 0.0.0.0 --port 30000
      --mem-fraction-static 0.90
      --kv-cache-dtype bfloat16
      --context-length 262144
      --trust-remote-code
      --attention-backend aiter
      --chunked-prefill-size 32768
      --tool-call-parser qwen3_coder

  architect-solo-deepseek-ai-DeepSeek-R1-Distill-Llama-8B:
    image: lmsysorg/sglang:v0.5.5.post3-rocm700-mi30x
    container_name: vylabs-builder-solo
    ipc: host
    network_mode: host
    privileged: true
    cap_add: [SYS_PTRACE]
    security_opt: [seccomp=unconfined]
    ulimits: *rocm_ulimits
    devices: *rocm_devices
    volumes: *rocm_volumes
    environment:
      - SGLANG_ALLOW_OVERWRITE_LONGER_CONTEXT_LEN=1
      - HSA_NO_SCRATCH_RECLAIM=1
      - HF_HOME=/root/.cache/huggingface
      - GLOO_SOCKET_IFNAME=eth0
      - NCCL_SOCKET_IFNAME=eth0
      - SGLANG_USE_AITER=1
      # [CRITICAL] Prevent Infinite Loop/Garbled Text at 262k
      - VLLM_USE_TRITON_FLASH_ATTN=0
    command: >
      python3 -m sglang.launch_server
      --model-path deepseek-ai/DeepSeek-R1-Distill-Llama-8B
      --tp 1 --host 0.0.0.0 --port 30000
      --mem-fraction-static 0.90
      --kv-cache-dtype bfloat16
      --context-length 262144
      --trust-remote-code
      --attention-backend aiter
      --chunked-prefill-size 32768
      --tool-call-parser qwen3_coder

  architect-solo-google-gemma-3-27b-it:
    image: lmsysorg/sglang:v0.5.5.post3-rocm700-mi30x
    container_name: vylabs-builder-solo
    ipc: host
    network_mode: host
    privileged: true
    cap_add: [SYS_PTRACE]
    security_opt: [seccomp=unconfined]
    ulimits: *rocm_ulimits
    devices: *rocm_devices
    volumes: *rocm_volumes
    environment:
      - SGLANG_ALLOW_OVERWRITE_LONGER_CONTEXT_LEN=1
      - HSA_NO_SCRATCH_RECLAIM=1
      - HF_HOME=/root/.cache/huggingface
      - GLOO_SOCKET_IFNAME=eth0
      - NCCL_SOCKET_IFNAME=eth0
      - SGLANG_USE_AITER=1
      # [CRITICAL] Prevent Infinite Loop/Garbled Text at 262k
      - VLLM_USE_TRITON_FLASH_ATTN=0
    command: >
      python3 -m sglang.launch_server
      --model-path google/gemma-3-27b-it
      --tp 1 --host 0.0.0.0 --port 30000
      --mem-fraction-static 0.90
      --kv-cache-dtype bfloat16
      --context-length 262144
      --trust-remote-code
      --attention-backend aiter
      --chunked-prefill-size 32768
      --tool-call-parser qwen3_coder

  architect-solo-moonshotai-Kimi-K2-Thinking:
    image: lmsysorg/sglang:v0.5.5.post3-rocm700-mi30x
    container_name: vylabs-builder-solo
    ipc: host
    network_mode: host
    privileged: true
    cap_add: [SYS_PTRACE]
    security_opt: [seccomp=unconfined]
    ulimits: *rocm_ulimits
    devices: *rocm_devices
    volumes: *rocm_volumes
    environment:
      - SGLANG_ALLOW_OVERWRITE_LONGER_CONTEXT_LEN=1
      - HSA_NO_SCRATCH_RECLAIM=1
      - HF_HOME=/root/.cache/huggingface
      - GLOO_SOCKET_IFNAME=eth0
      - NCCL_SOCKET_IFNAME=eth0
      - SGLANG_USE_AITER=1
      # [CRITICAL] Prevent Infinite Loop/Garbled Text at 262k
      - VLLM_USE_TRITON_FLASH_ATTN=0
    command: >
      python3 -m sglang.launch_server
      --model-path moonshotai/Kimi-K2-Thinking
      --tp 1 --host 0.0.0.0 --port 30000
      --mem-fraction-static 0.90
      --kv-cache-dtype bfloat16
      --context-length 262144
      --trust-remote-code
      --attention-backend aiter
      --chunked-prefill-size 32768
      --tool-call-parser qwen3_coder
